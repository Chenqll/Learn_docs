# MAIN
https://github.com/Oneflow-Inc/OneTeam/blob/63083c576fd1f6c627832651fad1ab1813028105/tutorial/howto_build_oneflow.md
# 补充
[远程下载 miniconda](https://blog.csdn.net/weixin_43264420/article/details/118179287)
## 删除build环境重新编译
- rm -f *

## 在15，16号机器，编译需要在gcc环境下
- 将clang环境改为gcc    
```
conda env create -f=dev/clang10/environment-v2.yml--->conda env create -f=dev/gcc7/environment-v2.yml
```
- 删除前面的build目录 然后新建一个build 重新cmake

## 缺少libunwind包，需要conda安装
- 需要在conda环境激活之前install
- 找conda包的途径 https://anaconda.org/conda-forge/libunwind
- 


```
[29/30] Linking CXX executable bin/oneflow_testexe
FAILED: bin/oneflow_testexe 
: && /home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/x86_64-conda_cos6-linux-gnu-c++ -fPIC -std=c++14 -Wall -Wno-sign-compare -Wno-unused-function -fPIC -O3 -DNDEBUG -std=c++14 -Wall -Wno-sign-compare -Wno-unused-function -fPIC -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,-rpath,/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib -Wl,-rpath-link,/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib -L/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib CMakeFiles/of_op_schema.dir/oneflow/core/framework/op_generated.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/balanced_splitter_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/cfg_reflection_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/channel_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/container_util_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/cplusplus_17_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/data_type_converter_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/decorator_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/fixed_vector_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/maybe_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/nd_index_offset_helper_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/optional_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/preprocessor_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/single_thread_obj_pool_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/common/symbol_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/control/ctrl_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/embedding/cache_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/embedding/key_value_store_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/common/primitive/broadcast_simplify_dims_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/common/primitive/permute_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/add_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/copy_nd_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/memcpy_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/memset_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/softmax_backward_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ep/test/primitive/softmax_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/framework/attr_map_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/framework/parallel_conf_util_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/framework/placement_sbp_util_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/dss_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/flat_msg_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/flat_msg_view_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/force_standard_layout_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/head_free_list_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/intrusive_core_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/list_hook_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/list_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/object_pool_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/skiplist_hook_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/skiplist_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/static_counter_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/intrusive/struct_traits_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/job/id_manager_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/job/parallel_desc_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/job/rank_group_scope_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/job/rank_group_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ndarray/cpu_concat_var_ndarray_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ndarray/cpu_slice_var_ndarray_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ndarray/cpu_var_ndarray_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/ndarray/slice_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/persistence/file_system_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/core/vm/bin_allocator_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/error_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/just_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/maybe_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/optional_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/type_traits_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/utility_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/maybe/variant_test.cpp.o CMakeFiles/oneflow_testexe.dir/oneflow/user/image/jpeg_decoder_test.cpp.o -o bin/oneflow_testexe  -Wl,-rpath,/home/chenqiaoling/oneflow/build_gcc_7:/home/chenqiaoling/oneflow/build_gcc_7/third_party_install/protobuf/lib:/home/chenqiaoling/oneflow/build_gcc_7/third_party_install/onednn/lib64:/home/chenqiaoling/oneflow/build_gcc_7/third_party_install/zlib/lib:/home/chenqiaoling/oneflow/build_gcc_7/third_party_install/nccl/lib:/usr/local/cudnn/cuda/lib64:/home/chenqiaoling/oneflow/build_gcc_7/_deps/glog-build:/home/chenqiaoling/oneflow/build_gcc_7/lib:/usr/local/cuda/lib64  -Wl,--whole-archive  liboneflow.so  libof_cfgobj.so  libof_functional_obj.a  -Wl,--no-whole-archive  -ldl  -lrt  third_party_install/protobuf/lib/libprotobuf.so  third_party_install/grpc/lib/libgrpc++_unsecure.a  third_party_install/grpc/lib/libgrpc_unsecure.a  third_party_install/grpc/lib/libgpr.a  third_party_install/grpc/lib/libupb.a  third_party_install/grpc/lib/libaddress_sorting.a  third_party_install/grpc/lib/libcares.a  /home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib/libopenblas.a  third_party_install/opencv/lib64/libopencv_imgproc.a  third_party_install/opencv/lib64/libopencv_imgcodecs.a  third_party_install/opencv/lib64/libopencv_core.a  third_party_install/opencv/share/OpenCV/3rdparty/lib64/libIlmImf.a  third_party_install/opencv/share/OpenCV/3rdparty/lib64/liblibjasper.a  third_party_install/opencv/share/OpenCV/3rdparty/lib64/liblibpng.a  third_party_install/opencv/share/OpenCV/3rdparty/lib64/liblibtiff.a  third_party_install/opencv/share/OpenCV/3rdparty/lib64/liblibwebp.a  third_party_install/cocoapi/lib/libcocoapi_static.a  third_party_install/libjpeg-turbo/lib/libturbojpeg.a  third_party_install/absl/lib64/libabsl_spinlock_wait.a  third_party_install/absl/lib64/libabsl_dynamic_annotations.a  third_party_install/absl/lib64/libabsl_malloc_internal.a  third_party_install/absl/lib64/libabsl_throw_delegate.a  third_party_install/absl/lib64/libabsl_int128.a  third_party_install/absl/lib64/libabsl_strings.a  third_party_install/absl/lib64/libabsl_str_format_internal.a  third_party_install/absl/lib64/libabsl_time.a  third_party_install/absl/lib64/libabsl_bad_optional_access.a  third_party_install/absl/lib64/libabsl_base.a  third_party_install/openssl/lib/libssl.a  third_party_install/openssl/lib/libcrypto.a  -lpthread  third_party_install/flatbuffers/lib/libflatbuffers.a  third_party_install/lz4/lib/liblz4.a  third_party_install/onednn/lib64/libdnnl.so  third_party_install/re2/lib/libre2.a  third_party_install/zlib/lib/libz.so  third_party_install/nccl/lib/libnccl.so  /usr/local/cudnn/cuda/lib64/libcudnn_cnn_infer.so  /usr/local/cudnn/cuda/lib64/libcudnn_cnn_train.so  /usr/local/cudnn/cuda/lib64/libcudnn_ops_infer.so  /usr/local/cudnn/cuda/lib64/libcudnn_ops_train.so  _deps/glog-build/libglog.so.0.5.0  lib/libgtest_main.so.1.11.0  /usr/local/cuda/lib64/libcudart_static.a  -ldl  /home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/x86_64-conda_cos6-linux-gnu/sysroot/usr/lib/librt.so  libof_protoobj.so  third_party_install/protobuf/lib/libprotobuf.so  /usr/local/cuda/lib64/libcublas.so  /usr/local/cuda/lib64/libcurand.so  /usr/local/cuda/lib64/libcublasLt.so  /usr/local/cuda/lib64/libnvjpeg.so  /usr/local/cuda/lib64/libnppc.so  /usr/local/cuda/lib64/libnppig.so  /home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib/libunwind.so  /home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/lib/libunwind-x86_64.so  lib/libgtest.so.1.11.0  -lpthread && :
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::NcclUniqueIdToString(ncclUniqueId const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::cfg::ErrorStackFrame::set_error_msg(std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpRegistryMgr::CheckAndGetOpKernelRegistry(std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: /usr/local/cudnn/cuda/lib64/libcudnn_cnn_infer.so: undefined reference to `memcpy@GLIBC_2.14'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpConfWrapper::input_size(std::string const&) const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::cfg::ConstErrorProto::DebugString() const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::FormatErrorStr(std::shared_ptr<oneflow::cfg::ErrorProto> const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::CudnnTensorDesc::CudnnTensorDesc(oneflow::DataType, oneflow::ShapeView const&, std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::EagerNcclCommMgr::GetCommForDeviceAndStreamName(std::set<std::pair<long, long>, std::less<std::pair<long, long> >, std::allocator<std::pair<long, long> > > const&, std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::GetInDim(oneflow::ShapeView const&, std::string const&, int, int)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpConfWrapper::output_size(std::string const&) const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpConfWrapper::has_input(std::string const&, int) const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::DeviceTag4DeviceType(oneflow::DeviceType)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::NcclUniqueIdFromString(std::string const&, ncclUniqueId*)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::cfg::ErrorStackFrame::set_function(std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::ShapeViewBase<long const>::ToString() const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpConfWrapper::op_type_name() const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::embedding::EmbeddingManager::GetKeyValueStore(std::string const&, long)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::Error::AddStackFrame(std::string const&, long const&, std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `google::base::CheckOpMessageBuilder::NewString()'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::OpKernelRegistry::SetInplaceProposalFn(std::function<oneflow::Maybe<void, void> (oneflow::user_op::InferContext const&, std::function<oneflow::Maybe<void, void> (std::string const&, int, std::string const&, int, bool)>)>)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::TxtString2PbMessage(std::string const&, google::protobuf::Message*)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `google::protobuf::internal::NameOfEnum(google::protobuf::EnumDescriptor const*, int)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::cfg::ErrorStackFrame::set_file(std::string const&)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::user_op::UserOpConfWrapper::has_output(std::string const&, int) const'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `oneflow::ParseBooleanFromEnv(std::string const&, bool)'
/home/chenqiaoling/miniconda3/envs/oneflow-dev-gcc7-v2/bin/../lib/gcc/x86_64-conda_cos6-linux-gnu/7.3.0/../../../../x86_64-conda_cos6-linux-gnu/bin/ld: liboneflow.so: undefined reference to `std::string const& oneflow::AttrValueCast<std::string>(oneflow::user_op::AttrVal const&)'
collect2: error: ld returned 1 exit status
ninja: build stopped: subcommand failed.
```